<script src="https://cdn.tailwindcss.com"></script>
<body class="bg-zinc-950"></body>
<!-- markdown view skining -->
<style>
  markdown-view {
    --h1: #A6F;
    --h2: #893;
    --code-sm: #88E;
    --code: #ABC;
    --info-bg: #222;
    --info-text: #888;
    --link: #56A;
    --hover-link: #78F;
    --scroll-bg: #131313;
    --scroll-tumb: #222;
    --scroll-hover: #89a15d;
  }

  ::-webkit-scrollbar { width: 1rem; }
  ::-webkit-scrollbar-track { background: var(--scroll-bg) }
  ::-webkit-scrollbar-thumb { background: var(--scroll-tumb) }
  ::-webkit-scrollbar-thumb:hover { background: var(--scroll-hover)}

  pre {
    scrollbar-width: thin;
    scrollbar-color: #111 #333!important;
  }

  sw {color:#fb8600}
  rw {color:#acd641}
  bw {color:#ac84d7}
  ew {color:#ac84d7}
  uw {color:#8f665f}
  st {color:#2fd57f}
  rm {color:#768d76}
  jd {color:#9ea77d}
  wt {color:#618be3}

</style>
<script src="old-bird-soft.js" type="module"></script>
<main class="min-h-screen bg-zinc-950 text-zinc-400">
  <section class="max-w-screen-2xl m-auto grid grid-cols-1 gap-2 lg:grid-cols-3">
    <textarea
    class="bg-zinc-800 text-zinc-400 focus:outline-none p-8 placeholder-zinc-600"
    placeholder=" - - - markdown editor - - - "
    spellcheck="false"
    ></textarea>
    <pre class="p-8 text-emerald-200 overflow-x-scroll hidden">
<bw>export</bw> <rw>const</rw> <u>MainFrame</u> <uw>=</uw> <sw>({</sw> children <sw>})</sw> <uw>=&gt;</uw> <sw>{</sw>
  <rw>const</rw> <sw>{</sw> theme, setTheme, switchTheme <sw>}</sw> <uw>=</uw> useDarkLightTheme<sw>()</sw>;
  useEffect<sw>(()</sw> <uw>=&gt;</uw> <sw>{</sw> setTheme<sw>(</sw>Theme.DARK<sw>)</sw>; <sw>}</sw>, <sw>[</sw>setTheme<sw>])</sw>;

  <rm>// this is a basic highlighting test</rm>

  <rw>return</rw> <sw>(</sw>
    <wt>&lt;main</wt> <bw>className</bw>=<st>"dark:bg-zinc-800 dark:text-white min-h-screen"</st><wt>&gt;</wt>
      <wt>&lt;button</wt>
        <bw>className</bw>=<st>"fixed right-0 p-2 m-2 rounded-lg dark:bg-black bg-white opacity-70 z-20"</st>
        <bw>onClick</bw>=<sw>{()</sw> <uw>=&gt;</uw> switchTheme<sw>()}</sw><wt>&gt;</wt>
          <sw>{</sw>theme<sw>}</sw>
      <wt>&lt;/button&gt;</wt>
      <wt>&lt;section</wt> <bw>className</bw>=<st>"m-auto max-w-screen-md"</st><wt>&gt;</wt>
        <sw>{</sw>children<sw>}</sw>
      <wt>&lt;/section&gt;</wt>
      <wt>&lt;/button&gt;</wt>Do Something<wt>&lt;/button&gt;</wt>
    <wt>&lt;/main&gt;</wt>
  <sw>)</sw>;
<sw>}</sw>;
</pre>
    <article class="bg-zinc-900 whitespace-pre-wrap px-8">
      <markdown-view source="textarea" />
    </article>
  </section>

  <template id="card">
    <figure class="
      fixed top-[30rem] left-[30rem]
      w-[7rem] h-[8.5rem]
      bg-slate-700
      bg-[url(../sprites/potter3m.png)]
      bg-[length:570%]
      rounded-xl
      --pointer-events-none
      border-[.2rem]
      border-black
    "></figure>
    <a href="https://github.com/mundimark/awesome-markdown-editors?tab=readme-ov-file">markdown editors collection</a>
  </template>

  <!-- markdown components -->
  <template id="code-block">
    <pre class="bg-zinc-950 p-4 text-lime-200 overflow-x-scroll"><slot></slot></pre>
  </template>
  <template class="head-1">
    <h1 class="text-orange-200 text-[2rem]"><slot></slot></h1>
  </template>
  <template class="head-2">
    <h2 class="text-orange-400 text-xl"><slot></slot></h2>
  </template>
  <template class="s-italic">
    <em><slot></slot></em>
  </template>
  <template id="info-block">
    <p class="bg-zinc-950 p-4 rounded"><slot></slot></p>
  </template>
  <!-- Check it: <a class="underline text-emerald-400" href="https://github.com/mundimark/awesome-markdown-editors?tab=readme-ov-file" target="_blank">markdown-ediotor-collections</a> -->
</main>

<script type="module">
  /**
   * https://mateam.net/html-escape-characters/
   *
   * @type {(str:string) => string}
   */
  const encodCodeBlockToSafeHtml = str => str
    .replaceAll(/[\&|<|>|\\|']/g,
    specialCharacter => ({
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      "\"": "&quot;",
      "\\": "&#92",
      "'": "&apos;",
      "`": "&#96",
      "|": "|"
    }[specialCharacter]));

  globalThis.safeEncode = encodCodeBlockToSafeHtml;

  /** @type {(safeCode:string) => string} */
  const syntaxHighlight = safeCode => {
    return encodCodeBlockToSafeHtml(safeCode)
      .replaceAll(/("[^&]*"|`[^&]*`|&apos;[^&]*&apos;)/g, "<st>$1</st>")
      .replaceAll(/(&lt;[^\s|^&]*&gt;)/g, "<wt>$1</wt>")
      .replaceAll(/(&lt;[^\s|^&|^\!]*)(\s+)/g, "<wt>$1</wt>$2")
      .replaceAll(/(\{|\}|\(|\)|\[|\])/g, "<sw>$1</sw>")
      .replaceAll(/(const|let|return|function|var|for|if|while|\?|\:)/g, "<rw>$1</rw>")
      .replaceAll(/(className|class|onClick|onInput|export|import|@type|@typedef|string|number|object|false|true)/g, "<ew>$1</ew>")
      .replaceAll(/(\=&gt;|\=|\|)/g, "<uw>$1</uw>")
      .replaceAll(/(\/\/(.*)$)/g, "<rm>$1</rm>")
      .replaceAll(/(\/\*\*[^\*|.]*\*\/)/g, "<jd>$1</jd>")
      .replaceAll(/(&lt;\!--[.|^&]*--&gt;)/g, "<rm>$1</rm>")
    ;
  }

  const inlineMarkdown = str => encodCodeBlockToSafeHtml(str)
    .replaceAll(/`([^`]*)`/g, `<span class="text-[--code-sm]">$1</span>`)
    .replaceAll(/\[([^\]]+)\]\(([^\)].+)\)/g,`<a class="
       transition-all
       duration-500
       text-white
       hover:text-sky-400
       hover:bg-sky-800
       p-2 rounded"
       href="$2"
      target="_blank">$1</a>
    `)

  /**
   * Very Earluy POC level Parser
   * @type {(source:string) => string}
   */
  const markdownParser = (source) => {
    let codeBlock = false;
    const CR = '\n';
    const lines = source.split(CR);
    return lines.map(
      line => {
        if (codeBlock) switch (true) {
            case /^\s*```/.test(line):
              codeBlock = false;
              return '</pre>'
            default: return syntaxHighlight(line);
          }

        if (!codeBlock) switch (true) {
          case /^\s*```/.test(line):
            codeBlock = true;
            return '<pre class="bg-zinc-950 p-4 text-emerald-200 overflow-x-scroll">'
          case /^\s*#\s/.test(line):
            return `<h1 class="text-orange-200 text-[2rem]">${inlineMarkdown(
              line.slice(line.indexOf('#') + 2 ?? 0)
            )}</h1>`;
          case /^\s*#+\s/.test(line):
            return `<h2 class="text-orange-400 text-xl">${inlineMarkdown(
              line.slice(line.indexOf('#') + 2 ?? 0)
            )}</h2>`;
          case /^\s*_[^_]+_/.test(line):
            return `<em>${inlineMarkdown(
              line.replaceAll('_', '')
            )}</em>`;
          case /^\s*>\s/.test(line):
            return `<p class="bg-zinc-950 p-4 rounded">${inlineMarkdown(
              line.replace('>','')
            )}</p>`;
          case /^\s*\!\[.*\]\(.*\)\s/.test(line):
            return `<picture>- image - placeholder -</picture>`;
          default:
            return inlineMarkdown(line);
        }
      }
    )
    .join(CR);
  }

  customElements.define('markdown-view', class extends HTMLElement {
    constructor () {
      super();
      const source = document.querySelector('textarea').value;
      globalThis.so = source;
      this.innerHTML = markdownParser(source);
    }

    changeContent (source) {
      this.innerHTML = markdownParser(source);
    }
  });

  const markdownView = document.querySelector('markdown-view');
  const markdownEditor = document.querySelector('textarea');

  markdownView.changeContent(`# <\\>
  ## Test the Editor!
  Please test the editor on left side.
  This is need to be proper work \`under\` the right way! [localhost](localhost)

> :: \`TODO\` ::
    - [x] fine size of editor / view
    - table
    - [x] code block
    - [x] HTML injection safe
    - subtitle \`error\` fix
    - [x] Set the right size of this two panel.
    - [x] Skining with \`CSS\` vars (just colors)
    - create a single panel editor,
      where I am immediatley edit on a proper edit.
    - more than one link in one line
    - [x] syntax highlight POC
    - add VIM motion to editor
    - add VS-Code shortkey to editor
    - save / load :: localhost
    - fix italic
    - collect all markdown element
    - collect all VIM motion
    - Web Animation API backed scroll animation
    - prot to \`Rust\`
    - YAML metadata - take look what exactly meanings

    [localhost](http://localhost)

    [this localhost](localhost)

    ## Why I would like to make this?

Because a big part of development is based on markdown \`documentation\`
If you would like inform me this is just a \`bullshit\`.
I am arguing the opposite is the true.

> Some code works something \`don't\`

## Syntax Highliter POC
Example of sytax highlight
- <bw> : basic word
- <rw> : reserved word
- <sw> : special word
- <tw> : tag word

> The most problematic highlighter is a \`HTML\` highlihter
Because the \`HTML\` can also contain: \`CSS\`, \`JS\`, \`RegExp\`, \`Template string\`, \`SVG\`, \`RegExp\` or even \`JSX\` also

\`\`\`
export const MainFrame = ({ children <sw>}) => {
  const { theme, setTheme, switchTheme } = useDarkLightTheme();
  useEffect(() => { setTheme(Theme.DARK); }, [setTheme]);

  return (
    <main className="dark:bg-zinc-800 dark:text-white min-h-screen">
      <button
        className="fixed right-0 p-2 m-2 rounded-lg dark:bg-black bg-white opacity-70 z-20"
        onClick={() => switchTheme()}>
          {theme}
      </button>
      <section className="m-auto max-w-screen-md">
        {children}
      </section>
    </main>
  );
\`\`\`



[Highlighter Code Example](https://www.w3schools.com/howto/tryit.asp?filename=tryhow_syntax_highlight)


_table test_

\`\`\`
| why hidden the first | this is very strange |
| -------------------- | -------------------- |
| hello                |                  100 |
| other                |                 1000 |
\`\`\`
## gameLoop
    - create a table
    - insert visual spot
    - insert hidden spot
    - put a bunch of cards to the table
    - real time card Edit capability

> Need to be figure out: how can I handle a so much \`language switch\`
Markdown -> HTML -> CSS ->
  Javascript -> JSX -> Typescript ->
  jsDoc -> Shader -> Wasm
  _in a single file for example_

## Code Example Working fine
without Syntax Highlight

\`\`\`javascript
import { useEffect } from "react";
import { Theme, useDarkLightTheme } from "../hooks/useDarkLightTheme";

export const MainFrame = ({ children }) => {
  const { theme, setTheme, switchTheme } = useDarkLightTheme();
  useEffect(() => { setTheme(Theme.DARK); }, [setTheme]);

  return (
    <main className="dark:bg-zinc-800 dark:text-white min-h-screen">
      <button
        className="fixed right-0 p-2 m-2 rounded-lg dark:bg-black bg-white opacity-70 z-20"
        onClick={() => switchTheme()}>
          {theme}
      </button>
      <section className="m-auto max-w-screen-md">
        {children}
      </section>
    </main>
  );
}
\`\`\`

---
title: "My First Post"
date: "2023-10-01"
slug: "my-first-post"
highlight: true
---
> also would like to handle a metadata part a differential way.

## Krita on tablet
Some brushes is very nice. UI is terrible.
But free so very usefull.

## Markdown editor of very few lines
Hi \`@pengeszikra\` In my process of creating Markdown, I'm using a "desktop" application for editing Markdown content. For example, I use Typora and/or Obsidian.

## VIM + VS
\`VIM + VS Code - vim extra functionality ->\`

     At least some VIM motion need to insert.
     But a few VS-Code motion is also handy.
     Let't buld  a really nice text editor, with
     a minimal codebase as possible.

     If I can conbine a markdown with a great
     soft editor then it will be fantastic.

     But now let's take a looke some game
     development improvements

                                               Strange editor

## Web Animation API
This code show animation is really fine way to create some nice animation.
Maybe I can combine the markdown editor with some animation.
Which is the way of \`MDX\` if I am right.

\`Skin\` markdown is very simple with combine the \`CSS\` and \`Tailwind\`

## Slash
Maybe I can crawl out of the box my long forgotten animation editor/language idea called: \`SLASH\` from the ages of \`Flash\`.

# ZEN development
## Keep in the Flow
What is means \`ZEN game development\` ? Sure it is part of \`pure HTML\` because the main idea is very simple:
Write your game without any library, game engine, compiling your code to somewhere else.
Just use a pure HTML page as starting point - even less ( I will be explaining a later )

## Loose your chain
Even thi editor also created this way. So the final target is creating everything from \`skratch\`.

> At the start your code looks like this:

\`\`\`html
// <script> tag broke the vite which is just Hot Reloader
// in this workflow

<main class="bg-zinc-800 text-zinc-400 p-8 min-h-screen">
  <!-- UI -->
</main>
\`\`\`

## The Black Hole Traveller!
 I don't know you are heard about the black hole traveller. This is a brand-new class of existing job in the universe or bright leader shoulder shaking new technology which I love to us to reach the forest edge of the universe without need a spend of the generation life, so that's why we brought, to invite you in our team us captain of our latest spaceship and we also would you like to meet your wall stuff?

 ## Super Small Editor
SSE - means Super Small Editor, the current state is show I am no so fare away of creating a simple Web Component to replace the \`VS Code\` to a really simple one. But my focus need to be on \`Game Hackhaton\` which is much more valuable project.

_the end_

----
                                                                    _happy coding_
  `)

  markdownEditor.addEventListener("input", e => {
    e.stopPropagation();
    markdownView.changeContent(e?.target?.value);
  })

  // Animation test over markdown editor

  const spriteSheet =
  [4, 26, 50, 74, 96].map((horizontal) =>
    [4, 36, 69, 103].map((vertical) => `${horizontal}% ${vertical}%`)
  ).flat();

  import { fragment } from './old-bird-soft.js';

  const anim = [
    { transform: "translateX(%0)" },
    { transform: "rotate(0) translate3D(-50%, -50%, 0)" },
    // { backgroundColor: "#431236", offset: 0.3 },
    { transform: "rotate(360deg) translate3D(-50%, -50%, 0)" },
    { transform: "translateX(%80)" },
  ]
  const timeline = {
    duration: 2000,
    iterations: Infinity
  }

  const rnd = range => Math.random() * range | 0;

  globalThis.startStop = () => {
    // if (an2.playState == 'running') {
    const actor = fragment('#card', 'body', 'card-02', 'figure')
    actor.style.top=`${rnd(55)}rem`;
    actor.style.left=`${rnd(70)}rem`;
    actor.style.transform=`scale(${Math.random()})`;
    actor.style.backgroundPosition = spriteSheet[rnd(spriteSheet.length)];
    // actor.addEventListener("click", () => {actor.pause()});
    // style don't work any more.
    actor.animate(anim, timeline);
    actor.playbackRate = rnd(5000);
    actor.play();
  }
</script>

<section class="fixed bottom-16 left-16 hidden">
  <button class="p-2 bg-sky-600 text-sky-200 m-2 rounded-full" onclick="globalThis.startStop()">card +</button>
</section>

<script src="https://cdn.tailwindcss.com"></script>
<body class="bg-zinc-950"></body>
<!-- markdown view skining -->
<style>
  markdown-view {
    --h1: #A6F;
    --h2: #893;
    --code-sm: #77F;
    --code: #ABC;
    --info-bg: #222;
    --info-text: #888;
    --link: #56A;
    --hover-link: #78F;
  }
</style>
<main class="min-h-screen bg-zinc-950 text-zinc-400">
  <section class="max-w-screen-2xl m-auto grid grid-cols-1 gap-2 lg:grid-cols-2">
    <textarea
    class="bg-zinc-800 text-zinc-400 focus:outline-none p-8 placeholder-zinc-600"
    placeholder=" - - - markdown editor - - - "
    spellcheck="false"
    ></textarea>
    <article class="bg-zinc-900 whitespace-pre-wrap px-8">
      <markdown-view source="textarea" />
    </article>
  </section>
  <template>
    <figure class="
      fixed top-[2rem] left-[2rem]
      w-[7rem] h-[12rem]
      rounded-xl pointer-events-none
      outline-lime-400 outline-1 outline-dashed
    "></figure>
    <a href="https://github.com/mundimark/awesome-markdown-editors?tab=readme-ov-file">markdown editors collection</a>
  </template>

  <!-- markdown components -->
  <template id="code-block">
    <pre class="bg-zinc-950 p-4 text-lime-200 overflow-x-scroll"><slot></slot></pre>
  </template>
  <template class="head-1">
    <h1 class="text-orange-200 text-[2rem]"><slot></slot></h1>
  </template>
  <template class="head-2">
    <h2 class="text-orange-400 text-xl"><slot></slot></h2>
  </template>
  <template class="s-italic">
    <em><slot></slot></em>
  </template>
  <template id="info-block">
    <p class="bg-zinc-950 p-4 rounded"><slot></slot></p>
  </template>
  <!-- Check it: <a class="underline text-emerald-400" href="https://github.com/mundimark/awesome-markdown-editors?tab=readme-ov-file" target="_blank">markdown-ediotor-collections</a> -->
</main>

<script>
  /**
   * https://mateam.net/html-escape-characters/
   *
   * @type {(str:string) => string}
   */
  const encodCodeBlockToSafeHtml = str => str
    .replaceAll(/[\&|<|>|\\|']/g,
    specialCharacter => ({
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      "\"": "&quot;",
      "\\": "&#92",
      "'": "&apos;",
      "`": "&#96",
      "|": "|"
    }[specialCharacter]));

  const inlineMarkdown = str => encodCodeBlockToSafeHtml(str)
    .replaceAll(/`([^`]*)`/g, `<span class="text-[--code-sm]">$1</span>`)
    .replaceAll(/\[([^\]]+)\]\(([^\)].+)\)/g,`<a class="transition-all duration-500 text-white hover:text-sky-400 hover:bg-sky-800 p-2 rounded" href="$2" target="_blank">$1</a>`)

  /**
   * Very Earluy POC level Parser
   * @type {(source:string) => string}
   */
  const markdownParser = (source) => {
    let codeBlock = false;
    const CR = '\n';
    const lines = source.split(CR);
    return lines.map(
      line => {
        if (codeBlock) switch (true) {
            case /^\s*```/.test(line):
              codeBlock = false;
              return '</pre>'
            default: return encodCodeBlockToSafeHtml(line);
          }

        if (!codeBlock) switch (true) {
          case /^\s*```/.test(line):
            codeBlock = true;
            return '<pre class="bg-zinc-950 p-4 text-lime-200 overflow-x-scroll">'
          case /^\s*#\s/.test(line):
            return `<h1 class="text-orange-200 text-[2rem]">${inlineMarkdown(
              line.slice(line.indexOf('#') + 2 ?? 0)
            )}</h1>`;
          case /^\s*#+\s/.test(line):
            return `<h2 class="text-orange-400 text-xl">${inlineMarkdown(
              line.slice(line.indexOf('#') + 2 ?? 0)
            )}</h2>`;
          case /^\s*_[^_]+_/.test(line):
            return `<em>${inlineMarkdown(
              line.replaceAll('_', '')
            )}</em>`;
          case /^\s*>\s/.test(line):
            return `<p class="bg-zinc-950 p-4 rounded">${inlineMarkdown(
              line.replace('>','')
            )}</p>`;
          case /^\s*\!\[.*\]\(.*\)\s/.test(line):
            return `<picture>- image - placeholder -</picture>`;
          default:
            return inlineMarkdown(line);
        }
      }
    )
    .join(CR);
  }

  customElements.define('markdown-view', class extends HTMLElement {
    constructor () {
      super();
      const source = document.querySelector('textarea').value;
      globalThis.so = source;
      this.innerHTML = markdownParser(source);
    }

    changeContent (source) {
      this.innerHTML = markdownParser(source);
    }
  });

  const markdownView = document.querySelector('markdown-view');
  const markdownEditor = document.querySelector('textarea');

  markdownView.changeContent(`# <\\>
  ## Test the Editor!
  Please test the editor on left side.
  This is need to be proper work \`under\` the right way! [localhost](localhost)

> :: \`TODO\` ::
    - [x] fine size of editor / view
    - table
    - [x] code block
    - [x] HTML injection safe
    - subtitle \`error\` fix
    - [x] Set the right size of this two panel.
    - [x] Skining with \`CSS\` vars (just colors)
    - create a single panel editor,
      where I am immediatley edit on a proper edit.
    - more than one link in one line
    - add VIM motion to editor
    - add VS-Code shortkey to editor
    - save / load :: localhost
    - fix italic
    - collect all markdown element
    - collect all VIM motion
    - Web Animation API backed scroll animation
    - prot to \`Rust\`
    - YAML metadata - take look what exactly meanings

    [localhost](http://localhost)

    [this localhost](localhost)

    ## Why I would like to make this?

Because a big part of development is based on markdown \`documentation\`
If you would like inform me this is just a \`bullshit\`.
I am arguing the opposite is the true.

_table test_

\`\`\`
| why hidden the first | this is very strange |
| -------------------- | -------------------- |
| hello                |                  100 |
| other                |                 1000 |
\`\`\`
## gameLoop
    - create a table
    - insert visual spot
    - insert hidden spot
    - put a bunch of cards to the table
    - real time card Edit capability

> Need to be figure out: how can I handle a so much \`language switch\`
Markdown -> HTML -> CSS ->
  Javascript -> JSX -> Typescript ->
  jsDoc -> Shader -> Wasm
  _in a single file for example_

## Code Example Working fine
without Syntax Highlight

\`\`\`javascript
import { useEffect } from "react";
import { Theme, useDarkLightTheme } from "../hooks/useDarkLightTheme";

export const MainFrame = ({ children }) => {
  const { theme, setTheme, switchTheme } = useDarkLightTheme();
  useEffect(() => { setTheme(Theme.DARK); }, [setTheme]);

  return (
    <main className="dark:bg-zinc-800 dark:text-white min-h-screen">
      <button
        className="fixed right-0 p-2 m-2 rounded-lg dark:bg-black bg-white opacity-70 z-20"
        onClick={() => switchTheme()}>
          {theme}
      </button>
      <section className="m-auto max-w-screen-md">
        {children}
      </section>
    </main>
  );
}
\`\`\`

---
title: "My First Post"
date: "2023-10-01"
slug: "my-first-post"
highlight: true
---
> also would like to handle a metadata part a differential way.

## Krita on tablet
Some brushes is very nice. UI is terrible.
But free so very usefull.

## Markdown editor of very few lines
Hi \`@pengeszikra\` In my process of creating Markdown, I'm using a "desktop" application for editing Markdown content. For example, I use Typora and/or Obsidian.

## VIM + VS
\`VIM + VS Code - vim extra functionality ->\`

     At least some VIM motion need to insert.
     But a few VS-Code motion is also handy.
     Let't buld  a really nice text editor, with
     a minimal codebase as possible.

     If I can conbine a markdown with a great
     soft editor then it will be fantastic.

     But now let's take a looke some game 
     development improvements

                                               Strange editor
----
                                                                    _happy coding_
  `)

  markdownEditor.addEventListener("input", e => {
    e.stopPropagation();
    markdownView.changeContent(e?.target?.value);
  })

</script>